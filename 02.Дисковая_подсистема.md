## Дисковая подсистема

Компетенции

- Работать с таблицей разделов диска
- Понимать разницу между GPT и MBR
- Корректно разбивать диск на разделы
- Выбирать нужный уровень RAID для поставленных задач
- Разбирается в принципах работы RAID массивов.
- Понимать разницу межда аппартной и програмной реализацией RAID


### <a name='toc'>Содержание</a>

1. [Задачи дисковой системы](#1)
2. [Программный и аппаратный RAID 0/1/5/6/10/60](#2)
3. [Перечислить виды RAID массивов и их отличия](#3)
4. [Информация о дисковой подсистеме - dmidecode, dmesg, smartctl](#4)
5. [Собрать программный RAID](#5)
6. [Восстановить RAID после сбоя](#6)
7. [MBR и GPT. Команды gdisk/fdisk/parted/partprobe](#7)
8. [Лабораторная работа](#8)
9. [Рекомендуемые источники](#recommended_sources)


<br>

**<a name='1'>Задачи дисковой системы</a>**

В Linux дисковая система (блочные устройства, файловые системы, менеджеры томов) выполняет следующие ключевые задачи:

**1. Управление блочными устройствами**

- Поддержка HDD, SSD, NVMe, USB-накопителей, сетевых хранилищ (iSCSI, NFS).
- Работа с разделами (`/dev/sda1`, `/dev/nvme0n1p2`).
- Инструменты: `fdisk`, `parted`, `lsblk`, `blkid`.

**2. Организация файловых систем**

- Форматирование и монтирование (`ext4`, `XFS`, `Btrfs`, `ZFS`).
- Автомонтирование (`/etc/fstab`).
- Проверка и восстановление (`fsck`, `xfs_repair`).

**3. Логическое управление дисками (LVM)**

- Создание и изменение томов (`pvcreate`, `vgcreate`, `lvresize`).
- "Горячее" добавление дисков, изменение размеров без отключения.
- Снапшоты (`lvcreate --snapshot`).

**4. Оптимизация производительности**

- Кэширование (через `bcache`, `dm-cache`).
- TRIM для SSD (`fstrim`).
- Настройка планировщика ввода-вывода (`deadline`, `noop`, `mq-deadline`).

**5. Надежность и мониторинг**

- Контроль состояния дисков (`smartctl` из пакета `smartmontools`).
- RAID (`mdadm` для программного `RAID`).
- Резервное копирование (`dd`, `rsync`, LVM-снапшоты).

**6. Безопасность**

- Шифрование (LUKS через `cryptsetup`).
- Разграничение прав доступа (стандартные Unix-права, `ACL`, `SELinux/AppArmor`).
- Защита от повреждений (журналирование в `ext4/XFS`).

**7. Сетевые и виртуальные хранилища**

- Подключение сетевых FS (`NFS`, `CIFS`).
- Виртуализация хранилищ (`DRBD`, `Ceph`).
- Контейнеры и overlay-ФС (aufs, `overlayfs`).

**Итог**: Дисковая подсистема Linux обеспечивает гибкость, отказоустойчивость и высокую производительность, поддерживая как классические `HDD`, так и современные `SSD/NVMe` с продвинутыми функциями (`LVM`, `RAID`, шифрование).



<br>

## <a name='2'>Программный и аппаратный RAID: уровни 0, 1, 5, 6, 10, 60</a>

RAID (Redundant Array of Independent Disks) — технология объединения дисков для повышения производительности, отказоустойчивости или обоих параметров.

**1. Аппаратный RAID**

**Что это?**
- Реализуется отдельным RAID-контроллером (например, от LSI, Adaptec).
- Не нагружает CPU, так как обработка RAID выполняется на контроллере.
- Часто имеет собственную память (кеш) и батарею (BBU) для защиты данных.

**Плюсы:**
- Высокая производительность (особенно при записи).
- Поддержка горячей замены (hot-swap) дисков.
- Независимость от ОС (работает до её загрузки).

**Минусы:**
- Дорогое оборудование.
- Зависимость от контроллера (при поломке возможны проблемы с переносом массива).


<hr>

**2. Программный RAID**

**Что это?**
- Управляется операционной системой (например, mdadm в Linux, Storage Spaces в Windows).
- Использует ресурсы CPU и RAM.

**Плюсы:**
- Бесплатно (не требует спецоборудования).
- Гибкость (легко перенести на другой компьютер).
- Поддержка в большинстве ОС.

**Минусы:**
- Нагрузка на процессор.
- Меньшая производительность при высоких нагрузках.
- Нет кеширования (если не используется дополнительное ПО).


<br>

### Виды RAID-массивов и их отличия

<br>

**1. RAID 0 (Stripe – чередование)**
**Принцип:** Данные разбиваются на блоки и записываются на несколько дисков параллельно.

**Минимум дисков:** 2.

**Преимущества:**
- Максимальная скорость чтения/записи (за счёт распараллеливания).
- 100% полезного места.

**Недостатки:**
- **Нет отказоустойчивости** – выход одного диска уничтожает весь массив.

**Где использовать:**
- Кэши, временные данные, игровые ПК (где важна скорость, но не сохранность).


<hr>

**2. RAID 1 (Mirror – зеркало)**

**Принцип:** Полное дублирование данных на 2+ дисках.

**Минимум дисков:** 2.

**Преимущества:**
- Высокая надёжность (работает, пока жив хотя бы один диск).
- Быстрое восстановление (простое копирование).

**Недостатки:**
- Только 50% полезного места (в 2-дисковой конфигурации).

**Где использовать:**
- Системные разделы, критически важные данные.


<hr>

**3. RAID 5 (Parity – чередование с чётностью)**

**Принцип:** Данные и контрольные суммы распределяются по всем дискам.

**Минимум дисков: 3.**

**Преимущества:**
- Оптимальный баланс скорости и надёжности.
- Эффективное использование места (N-1 дисков, где N – общее количество).

**Недостатки:**
- Медленная запись (из-за расчёта чётности).
- Риск потери данных при отказе 2+ дисков.

**Где использовать:**
- Файловые серверы, базы данных.


<hr>

**4. RAID 6 (Двойная чётность)**

**Принцип:** Как RAID 5, но с двумя контрольными суммами.

**Минимум дисков:** 4.

**Преимущества:**
- Выдерживает отказ двух дисков.

**Недостатки:**
- Ещё медленнее запись, чем в RAID 5.
- Больше накладных расходов (N-2 дисков).

**Где использовать:**
- Серверы с высокими требованиями к надёжности.


<hr>

**5. RAID 10 (1+0 – зеркало + чередование)**

**Принцип:** Сначала зеркалирование (RAID 1), затем чередование (RAID 0).

**Минимум дисков:** 4.

**Преимущества:**
- Высокая скорость + отказоустойчивость (можно потерять до половины дисков, если они из разных пар).

**Недостатки:**
- Только 50% полезного места.

**Где использовать:**
- Базы данных, виртуализация, высоконагруженные серверы.


<hr>

**6. RAID 50 (RAID 5 + RAID 0)**

**Принцип:** Несколько RAID 5 объединяются в RAID 0.

**Минимум дисков:** 6 (2 группы по 3).

**Преимущества:**
- Лучшая производительность, чем у RAID 5.
- Можно потерять по 1 диску в каждой группе.

**Недостатки:**
- Сложность восстановления.

**Где использовать:**
- Средние и крупные хранилища с балансом скорости и надёжности.


<hr>

**7. RAID 60 (RAID 6 + RAID 0)**

**Принцип:** Несколько RAID 6 объединяются в RAID 0.

**Минимум дисков:** 8 (2 группы по 4).

**Преимущества:**
- Максимальная надёжность (можно потерять по 2 диска в каждой группе).
- Высокая скорость чтения.

**Недостатки:**
- Очень большие накладные расходы (N-2 дисков).

**Где использовать:**
- Крупные хранилища, требующие максимальной отказоустойчивости.


**Вывод**

- Для скорости: RAID 0, 10, 50, 60.
- Для надёжности: RAID 1, 5, 6, 10, 60.
- Баланс: RAID 5, 10, 50.

Выбор зависит от требований к **производительности**, **надежности** и **бюджета**.



<br>

### <a name='recommended_sources'>Рекомендуемые источники</a>

- [*********************](https://kernel.ubuntu.com/mainline/)
