## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NFS —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ Linux

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å NFS (Network File System) —Å–µ—Ä–≤–µ—Ä –º–æ–∂–Ω–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ Linux (Ubuntu/Debian –∏–ª–∏ CentOS/RHEL).


### ‚úÖ 1.  –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NFS-—Å–µ—Ä–≤–µ—Ä–∞

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (NFS Server)**

```ruby
# –î–ª—è Ubuntu/Debian
sudo apt update
sudo apt install nfs-kernel-server

# –î–ª—è CentOS/RHEL
sudo yum install nfs-utils
```


<br>

#### :diamond_shape_with_a_dot_inside: 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ**

–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ —Ä–∞—Å—à–∞—Ä–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/shared`):

```ruby
sudo mkdir /srv/nfs/share
sudo chown nobody:nogroup /srv/shared  # –î–ª—è Ubuntu/Debian
sudo chmod 777 /srv/nfs/share

# –ò–ª–∏ –¥–ª—è CentOS/RHEL:
sudo chown nobody:nobody /srv/nfs/share
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –ø–∞–ø–∫—É –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ:**

- `nobody:nogroup` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è NFS –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
- `777` ‚Äî –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—å –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, `755` –¥–ª—è —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏—è).



<br>

#### :diamond_shape_with_a_dot_inside: 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ (NFS Exports)

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ**

```ruby
sudo nano /etc/exports

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ø—Ä–∏–º–µ—Ä—ã):
/srv/nfs/share 192.168.11.0/255.255.255.0(rw,sync,no_subtree_check) # –î–æ—Å—Ç—É–ø –¥–ª—è –≤—Å–µ–π –ø–æ–¥—Å–µ—Ç–∏
/srv/nfs/share client_ip(rw,sync,no_root_squash)                    # –î–æ—Å—Ç—É–ø –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ IP
```

–ì–¥–µ:

- `rw` ‚Äî —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å
- `sync` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å (–ª—É—á—à–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å)
- `no_subtree_check` ‚Äî —É—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É, –Ω–æ –º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ
- `no_root_squash` ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç root-–∫–ª–∏–µ–Ω—Ç–∞–º –ø–æ–ª—É—á–∞—Ç—å root-–¥–æ—Å—Ç—É–ø (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)


#### üîπ 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –∑–∞–ø—É—Å–∫ NFS

```ruby
sudo exportfs -a
sudo systemctl restart nfs-kernel-server
sudo systemctl enable nfs-kernel-server
```


#### :diamond_shape_with_a_dot_inside: 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

```ruby
sudo exportfs -v
sudo showmount -e localhost
```


#### :diamond_shape_with_a_dot_inside: 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–µ—Ä–≤–æ–ª–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

```ruby
sudo ufw allow from 192.168.1.0/24 to any port nfs
sudo ufw allow from 192.168.1.0/24 to any port rpcbind
sudo ufw enable

# –î–ª—è Ubuntu/Debian (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ufw)
sudo ufw allow from 192.168.1.0/24 to any port nfs

# –î–ª—è CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-service=nfs
sudo firewall-cmd --permanent --add-service=mountd
sudo firewall-cmd --permanent --add-service=rpc-bind
sudo firewall-cmd --reload

# –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã NFS
# NFS (TCP/UDP 2049)
sudo iptables -A INPUT -p tcp --dport 2049 -j ACCEPT
sudo iptables -A INPUT -p udp --dport 2049 -j ACCEPT

# RPCBind (Portmapper, TCP/UDP 111)
sudo iptables -A INPUT -p tcp --dport 111 -j ACCEPT
sudo iptables -A INPUT -p udp --dport 111 -j ACCEPT

# Mountd (TCP/UDP 892)
sudo iptables -A INPUT -p tcp --dport 892 -j ACCEPT
sudo iptables -A INPUT -p udp --dport 892 -j ACCEPT

# Statd (TCP/UDP 662)
sudo iptables -A INPUT -p tcp --dport 662 -j ACCEPT
sudo iptables -A INPUT -p udp --dport 662 -j ACCEPT

# Lockd (TCP 32803, UDP 32769)
sudo iptables -A INPUT -p tcp --dport 32803 -j ACCEPT
sudo iptables -A INPUT -p udp --dport 32769 -j ACCEPT

# Rquotad (TCP/UDP 875)
sudo iptables -A INPUT -p tcp --dport 875 -j ACCEPT
sudo iptables -A INPUT -p udp --dport 875 -j ACCEPT
```
![image](https://github.com/user-attachments/assets/d6779b75-ced3-44c8-b654-c83d968d321c)

![image](https://github.com/user-attachments/assets/61ae7852-62fa-4642-9383-079fbad1bb1f)


<br>

### ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞

```ruby
# NFS-–∫–ª–∏–µ–Ω—Ç –¥–ª—è Ubuntu/Debian
sudo apt update
sudo apt install nfs-common

# –î–ª—è CentOS/RHEL
sudo yum install nfs-utils
```

```ruby
# –ú–æ–Ω—Ç–∏—Ä—É–µ–º –æ–±—â—É—é –ø–∞–ø–∫—É
sudo mkdir /mnt/confluence_sharedhome
sudo mount -t nfs 192.168.11.150:/srv/nfs/share /mnt/confluence_sharedhome

# –î–ª—è –∞–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–±–∞–≤—å—Ç–µ –≤ `/etc/fstab`
192.168.11.150:/srv/nfs/share /mnt/confluence_sharedhome nfs defaults,_netdev,noatime 0 0
```

![image](https://github.com/user-attachments/assets/b039e6e9-ee3d-4664-bb04-34f0b2ca0923)
![image](https://github.com/user-attachments/assets/41c214e0-1476-4ab5-ba6b-9e6323ef4365)

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**

```ruby
df -h | grep nfs
ls /mnt/nfs_share
```
![image](https://github.com/user-attachments/assets/41c214e0-1476-4ab5-ba6b-9e6323ef4365)


_–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å NFS-—Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å._



<br>

#### :diamond_shape_with_a_dot_inside: –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

1. **"Access denied"** ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `/etc/exports` –∏ `firewall`.
   - _–†–µ—à–µ–Ω–∏–µ 1_: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `/etc/exports` –µ—Å—Ç—å `rw` –∏ `all_squash`.
   - _–†–µ—à–µ–Ω–∏–µ 2_: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–∞–ø–∫–∞ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ `777` –∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ `nobody:nogroup`
3. **"Permission denied"** ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫—É (`chmod`, `chown`) –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.
4. **–ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞** ‚Äî –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å `async` –≤ `/etc/exports` (–Ω–æ —ç—Ç–æ –º–µ–Ω–µ–µ –Ω–∞–¥–µ–∂–Ω–æ).

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ —Ç–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Kerberos-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è), —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ `NFSv4` —Å `sec=krb5`.


[NFS Ubuntu](https://help.ubuntu.ru/wiki/nfs)
