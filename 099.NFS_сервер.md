## Настройка NFS сервера на Linux

Настроить NFS (Network File System) сервер можно следующим образом. Рассмотрим настройку на примере Linux (Ubuntu/Debian или CentOS/RHEL).


<br>

### 1. Установка необходимых пакетов

**На сервере (NFS Server)**

```ruby
# Для Ubuntu/Debian
sudo apt update
sudo apt install nfs-kernel-server

# Для CentOS/RHEL
sudo yum install nfs-utils
```

**На клиенте (NFS Client)**

```ruby
# Для Ubuntu/Debian
sudo apt update
sudo apt install nfs-common

# Для CentOS/RHEL
sudo yum install nfs-utils
```


<br>

### 2. Создание и настройка экспортируемой директории

**На сервере**

Создайте папку, которую хотите расшарить (например, `/shared`):

```ruby
sudo mkdir /shared
sudo chown nobody:nogroup /shared  # Для Ubuntu/Debian

# Или для CentOS/RHEL:
sudo chown nobody:nobody /shared
```

> **Примечание**: Можно использовать другую папку и права доступа.



<br>

### 3. Настройка экспорта NFS (на сервере)

Отредактируйте файл `/etc/exports`:

```ruby
sudo nano /etc/exports
```

Добавьте строку с указанием:

- Директории для экспорта
- Доступных клиентов (IP или подсеть)
- Прав доступа

Пример:

```ruby
/shared 192.168.1.0/24(rw,sync,no_subtree_check,no_root_squash)
```

Где:

- `rw` — чтение и запись
- `sync` — синхронная запись (лучшая надежность)
- `no_subtree_check` — ускоряет работу, но менее безопасно
- `no_root_squash` — позволяет root-клиентам получать root-доступ (осторожно!)

**Варианты доступа:**

- `ro` — только чтение
- `rw` — чтение и запись
- `root_squash / no_root_squash` — ограничение прав root-пользователей



<br>

### 4. Применение настроек NFS

После редактирования `/etc/exports` выполните:

```ruby
sudo exportfs -a  # Применить все экспорты
sudo systemctl restart nfs-kernel-server  # Перезапуск NFS (Ubuntu/Debian)

# Или для CentOS/RHEL:
sudo systemctl restart nfs-server
```



<br>

### 5. Открытие firewall (если используется)

```ruby
# Для Ubuntu/Debian (если используется ufw)
sudo ufw allow from 192.168.1.0/24 to any port nfs

# Для CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-service=nfs
sudo firewall-cmd --permanent --add-service=mountd
sudo firewall-cmd --permanent --add-service=rpc-bind
sudo firewall-cmd --reload
```



<br>

### 6. Подключение NFS на клиенте

**Создайте точку монтирования**

```ruby
sudo mkdir /mnt/nfs_share
```

**Смонтируйте NFS-шару**

```ruby
sudo mount -t nfs <SERVER_IP>:/shared /mnt/nfs_share
```

> Замените `<SERVER_IP>` на IP-адрес NFS-сервера.

**Проверьте подключение**

```ruby
df -h | grep nfs
ls /mnt/nfs_share
```


<br>

### 7. Автомонтирование при загрузке (опционально)

Добавьте запись в `/etc/fstab`:

```ruby
sudo nano /etc/fstab
```

Добавьте строку:

```ruby
<SERVER_IP>:/shared  /mnt/nfs_share  nfs  defaults  0  0
```

Проверьте:

```ruby
sudo mount -a
```



<br>

### 8. Проверка работы NFS

- На сервере создайте файл в `/shared` и проверьте его наличие на клиенте.
- Убедитесь, что права доступа работают корректно.



<br>

### Возможные проблемы и решения

1. **"Access denied"** — проверьте `/etc/exports` и `firewall`.
2. **"Permission denied"** — убедитесь, что права на папку (`chmod`, `chown`) корректны.
3. **Медленная работа** — попробуйте добавить `async` в `/etc/exports` (но это менее надежно).

Если нужна более тонкая настройка (например, Kerberos-аутентификация), рассмотрите `NFSv4` с `sec=krb5`.
