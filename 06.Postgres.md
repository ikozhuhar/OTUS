## postgres

:white_check_mark: _Задача: <a name='1'>Мониторинг подключений</a>_

```ruby
# Посмотреть все активные подключения. Выполнение непосредственно на сервере (рекомендуется)
sudo -u postgres psql -c "SELECT pid, usename, datname, state, client_addr, client_port FROM pg_stat_activity;"

# Посмотреть только idle-подключения
sudo -u postgres psql -c "SELECT pid, usename, datname, state, client_addr FROM pg_stat_activity WHERE state = 'idle';"
```

_Если нужно закрыть idle-подключения:_

```ruby
# Завершить конкретное подключение
sudo -u postgres psql -c "SELECT pg_terminate_backend(427682);"

# Завершить все idle-подключения старше 1 часа
sudo -u postgres psql -c "SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE state = 'idle' AND pid <> pg_backend_pid() AND state_change < now() - interval '1 hour';"
```
